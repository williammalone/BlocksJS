/*! BlocksJS 2014-04-10 */
var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.block=function(a){"use strict";var b,c=BLOCKS.eventDispatcher(),d=[],e={},f=(a&&a.name,[]),g=a&&a.layer,h=function(){b.scale=c.scale,b.angle=c.angle,c.minHotspot>=0&&(b.minHotspot=c.minHotspot),b.x=c.x,b.y=c.y,b.visible=c.visible,b.alpha=c.alpha,b.colorize=c.colorize},i=function(a){var b;for(a.removeEventListener("destroyed",i),b=0;b<f.length;b+=1){f.splice(b,1);break}};return c.x=a&&a.x||0,c.y=a&&a.y||0,c.angle=a&&a.angle||0,c.scale=a&&void 0!==a.scale?a.scale:1,c.alpha=a&&void 0!==a.alpha?a.alpha:1,c.visible=a&&void 0!==a.visible?a.visible:!0,c.update=function(){c&&b&&(h(),b.update(),b.dirty&&(c.dirty=b.dirty))},c.render=function(){c&&(c.dirty||b.dirty)&&(b.justTapped=c.justTapped,b.justNotTapped=c.justNotTapped,b.dragging=c.dragging,b.justReleased=c.justReleased,b.tapPos=c.tapPos,h(),b.dirty=!0,b.render(),c.dirty=!1)},c.addSlice=function(a){var b;return g&&(a.layer=g),b=BLOCKS.slice(a),a.name||(b.name="unnamedSlice"+d.length),d.push(b),e[a.name]=b,b.addEventListener("complete",function(){c.dispatchEvent("complete")}),1===d.length&&c.setSlice(a.name),b},c.getSlice=function(a){return void 0===a?b:e[a]},c.setSlice=function(a){var d;return d=e[a],d?(c.layer=d.layer,c.width=d.width,c.height=d.height,c.dirty=!0,b&&(b.layer.dirty=!0),b=d,h(),b.reset(),b.play(),!0):!1},c.show=function(){c.visible||(c.visible=!0,c.dirty=!0)},c.hide=function(){c.visible&&(c.visible=!1,c.dirty=!0)},c.motorize=function(a){a.addEventListener("destroyed",i),f.push(a)},c.stopMotors=function(a){var b,c=f.slice(0);for(b=0;b<c.length;b+=1)a?c[b].type===a&&c[b].destroy():c[b].destroy()},c.pause=function(){b.pause()},c.unpause=function(){b.unpause()},c.reset=function(){b.reset()},c.stop=function(){b.stop()},c.play=function(){b.play()},c.isPointInside=function(a){return h(),b.isPointInside(a)},c.getBounds=function(a){return h(),b.getBounds(a)},c.isRectInside=function(a){return h(),b.isRectInside(a)},c.gotoLastFrame=function(){b.gotoLastFrame()},c.destroy=function(){var a;if(c){for(c.stopMotors(),a=0;a<d.length;a+=1)d[a].destroy();d=null,e=null,b=null,c=null}},function(){var b,d=a&&a.spec;if(d){if(d.slices)for(b=0;b<d.slices.length;b+=1)c.addSlice(d.slices[b]);c.x=d.x||0,c.y=d.y||0}}(),c};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.log=function(a){window.console&&window.console.log&&window.console.log(a)},BLOCKS.warn=function(a){window.console&&(window.console.warn?window.console.warn(a):window.console.log&&window.console.log(a))},BLOCKS.debug=function(a){window.console&&(window.console.debug?window.console.debug(a):window.console.log&&window.console.log(a))},BLOCKS.error=function(a){window.console&&(window.console.error?window.console.error(a):window.console.log&&window.console.log(a))},BLOCKS.dir=function(a){window.console&&(window.console.dir?window.console.dir(a):window.console.log&&window.console.log(a))};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.clock=function(){"use strict";var a,b=BLOCKS.eventDispatcher(),c=!0,d=function(){c||(b.dispatchEvent("tick"),a=window.requestAnimationFrame(d),b.dispatchEvent("render"))};return b.stop=function(){window.cancelAnimationFrame(a),c=!0},b.start=function(){c&&(c=!1,a=window.requestAnimationFrame(d))},b.destroy=function(){b.stop(),b=null},function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}(),b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.container=function(a){"use strict";var b=BLOCKS.eventDispatcher(),c=[],d=[],e=function(a){var b;for(a.removeEventListener("destroyed",e),b=0;b<d.length;b+=1){d.splice(b,1);break}};return b.visible=!0,b.dirty=!0,b.layers={},b.assignLayer=function(c){var d,e,f;if(b.layers[c])BLOCKS.error("Layer already assigned to this container: "+c);else for(d=0;d<a.layers.length;d+=1){f=!1;for(e in b.layers)if(b.layers.hasOwnProperty(e)&&a.layers[d]===b.layers[e]){f=!0;break}if(!f)return b.layers[c]=a.layers[d],b.layers[c]}},b.addView=function(a){c.push(a)},b.removeView=function(a){var b;for(b=0;b<c.length;b+=1)if(a===c[b]){c.splice(b,1);break}},b.clear=function(){var a;for(a in b.layers)b.layers.hasOwnProperty(a)&&b.layers[a].clear()},b.motorize=function(a){a.addEventListener("destroyed",e),d.push(a)},b.update=function(){var a;for(a=0;a<c.length;a+=1)c[a].update()},b.render=function(){var a,d,e={};if(b.visible){for(a=0;a<c.length;a+=1)(c[a].dirty||b.dirty||c[a].layer.dirty)&&(e[c[a].layer.name]=c[a].layer);for(d in e)e.hasOwnProperty(d)&&e[d].clear();for(a=0;a<c.length;a+=1)e[c[a].layer.name]&&(c[a].dirty=!0),c[a].render()}b.dirty=!1},b.destroy=function(){var a;for(a=0;a<c.length;a+=1)c[a].destroy(),c[a]=null;c=null},b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.controller=function(a){"use strict";var b,c=BLOCKS.eventDispatcher(),d=function(a){var b,c={x:a.offsetLeft,y:a.offsetTop};return a.offsetParent&&(b=d(a.offsetParent),c.x+=b.x,c.y+=b.y),c},e=function(){a||(a=document.getElementById("BlocksGame")),a.addEventListener("orientationchange",f,!0),document.addEventListener("keydown",g,!0),document.addEventListener("keyup",h,!0),a.addEventListener("touchstart",j,!0),a.addEventListener("touchmove",j,!0),a.addEventListener("touchend",j,!0),a.addEventListener("touchcancel",j,!0),a.addEventListener("mousedown",k,!0),a.addEventListener("mousemove",k,!0),a.addEventListener("mouseup",k,!0),a.addEventListener("mousecancel",k,!0)},f=function(){if(c.listening){switch(window.orientation){case-90:c.orientation="landscape";break;case 0:c.orientation="portrait";break;case 90:c.orientation="landscape";break;case 180:c.orientation="portrait"}c.dispatchEvent("orientationChange",{orientation:c.orientation})}},g=function(a){c.listening&&c.dispatchEvent("keyDown",a)},h=function(a){c.listening&&c.dispatchEvent("keyUp",a)},i=function(a,b){switch(b){case"tap":c.drag=!0,c.dispatchEvent("tap",a);break;case"drag":c.drag=!0,c.dispatchEvent("drag",a);break;case"release":c.drag=!1,c.dispatchEvent("release",a);break;case"cancel":c.drag=!1,c.dispatchEvent("cancel",a)}},j=function(e){var f,g,h,j,k;if(c.listening){e.preventDefault&&e.preventDefault(),b=d(a),k=e.changedTouches[0],h={};for(g in k)k.hasOwnProperty(g)&&(h[g]=k[g]);for(h.x=(k.clientX-b.x-c.offsetX)*c.scaleX,h.y=(k.clientY-b.y-c.offsetY)*c.scaleY,h.type=e.type,h.touches=[],f=0;f<e.touches.length;f+=1){h.touches[f]={};for(g in e.touches[f])e.touches[f].hasOwnProperty(g)&&(h.touches[f][g]=e.touches[f][g]);h.touches[f].x=(h.touches[f].clientX-b.x-c.offsetX)*c.scaleX,h.touches[f].y=(h.touches[f].clientY-b.y-c.offsetY)*c.scaleY}for(h.changedTouches=[],f=0;f<e.changedTouches.length;f+=1){h.changedTouches[f]={};for(g in e.changedTouches[f])e.changedTouches[f].hasOwnProperty(g)&&(h.changedTouches[f][g]=e.changedTouches[f][g]);h.changedTouches[f].x=(h.changedTouches[f].clientX-b.x-c.offsetX)*c.scaleX,h.changedTouches[f].y=(h.changedTouches[f].clientY-b.y-c.offsetY)*c.scaleY}switch(h.type){case"touchstart":j="tap",c.dispatchEvent("touchStart",h);break;case"touchmove":j="drag",c.dispatchEvent("touchMove",h);break;case"touchend":j="release",c.dispatchEvent("touchEnd",h);break;case"touchcancel":j="cancel",c.dispatchEvent("touchCancel",h)}i(h,j)}},k=function(e){var f,g,h;if(c.listening){h={};for(f in e)e.hasOwnProperty(f)&&(h[f]=e[f]);switch(b=d(a),h.x=(h.clientX-b.x-c.offsetX)*c.scaleX,h.y=(h.clientY-b.y-c.offsetY)*c.scaleY,h.identifier="mouse",h.touches=[h],h.changedTouches=[h],h.type){case"mousedown":g="tap",c.dispatchEvent("mouseDown",h);break;case"mousemove":g="drag",c.dispatchEvent("mouseMove",h);break;case"mouseup":g="release",c.dispatchEvent("mouseUp",h);break;case"mousecancel":g="cancel",c.dispatchEvent("mouseCancel",h)}i(h,g)}};return c.scaleX=1,c.scaleY=1,c.offsetX=0,c.offsetY=0,c.listening=!0,c.simulateKeyDownEvent=function(a){g({keyCode:a})},c.simulateKeyUpEvent=function(a){h({keyCode:a})},e(),c};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.eventDispatcher=function(){"use strict";var a={},b={};return a.dispatchEvent=function(a,c){var d,e=[],f=[];if(b[a]){for(d=0;d<b[a].length;d+=1)e.push(b[a][d].callback),b[a][d].destroyOnDispatch||f.push(b[a][d]);for(b[a]=f,d=0;d<e.length;d+=1)e[d](c)}},a.addEventListener=function(a,c,d){b[a]||(b[a]=[]),b[a].push({name:a,callback:c,destroyOnDispatch:d})},a.removeEventListener=function(a,c){var d;if(b[a])for(d=0;d<b[a].length;d+=1)c?b[a][d].callback===c&&(b[a][d]=null,b[a].splice(d,1)):(b[a][d]=null,b[a].splice(d,1))},a};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.game=function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m=BLOCKS.eventDispatcher(),n=a&&void 0!==a.debug?a.debug:!1,o=BLOCKS.clock(),p=!1,q=[],r=[],s=function(){var a,b=[],c=[];for(a=0;a<r.length;a+=1)r[a].curTick+=1,r[a].curTick>=r[a].totalTicks?c.push(r[a]):b.push(r[a]);for(r=b,a=0;a<c.length;a+=1)c[a].callback(c[a].parameters)},t=function(){(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&(90===window.orientation||-90===window.orientation)&&window.scrollTo(0,0),L()},u=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?m.pause():m.unpause()},v=function(){l||(m.controller.removeEventListener("tap",v),l=!0,m.introScreen&&(m.introScreen.destroy(),m.introScreen=null),m.state="loading",m.speaker.load(),K())},w=function(){c=document.createElement("article"),c.id="BlocksGameContainer",a.minHeight&&(i=a.minHeight,c.style.minHeight=i+"px"),j=void 0!==a.scaleLandscape?a.scaleLandscape:!0,k=void 0!==a.scalePortrait?a.scalePortrait:!0,m.element.appendChild(c),d=document.createElement("article"),d.id="BlocksInteractionContainer",c.appendChild(d),m.controller=BLOCKS.controller(d),n&&(e=BLOCKS.virtualKeyboard(m.controller,{layer:m.createLayer("internalblocksjsdebuglayer",{zIndex:999999},!1),x:100,y:100,width:m.width-200,height:m.height-200,customKeys:a.customVirtualKeys})),window.addEventListener("orientationchange",t),window.addEventListener("resize",L),L(),m.controller.addEventListener("keyUp",A),m.controller.addEventListener("keyDown",z),m.controller.addEventListener("tap",B),m.controller.addEventListener("drag",C),m.controller.addEventListener("release",D),m.controller.addEventListener("cancel",D),m.controller.addEventListener("touchStart",E),m.controller.addEventListener("touchMove",F),m.controller.addEventListener("touchEnd",G),m.controller.addEventListener("touchCancel",G),m.controller.addEventListener("mouseDown",H),m.controller.addEventListener("mouseMove",I),m.controller.addEventListener("mouseUp",J),m.controller.addEventListener("mouseCancel",J),m.controller.addEventListener("tap",v),"undefined"!=typeof document.hidden?document.addEventListener("visibilitychange",u):"undefined"!=typeof document.mozHidden?document.addEventListener("mozvisibilitychange",u):"undefined"!=typeof document.msHidden?document.addEventListener("msvisibilitychange",u):"undefined"!=typeof document.webkitHidden&&document.addEventListener("webkitvisibilitychange",u)},x=function(){var a;if(!p){if(!m.update)return BLOCKS.error("Game requires a 'update' method."),o.stop(),void 0;for(a=+new Date,h+=a-g,g=a,h>1e3&&(h=1e3);h>=16.666666666;)n&&e.update(),s(),m.update(),h-=1e3/60,m.dispatchEvent("tick")}},y=function(){p||(n&&e.render(),m.render?(m.dispatchEvent("render"),m.render()):(BLOCKS.error("Game requires a 'render' method."),o.stop()))},z=function(a){m.keyDown&&m.keyDown(a)},A=function(a){m.keyUp&&m.keyUp(a)},B=function(a){n&&(a.x<100&&a.y<100&&(f=window.setTimeout(function(){e.visible=!e.visible,e.dirty=!0},1e3)),e.onTap(a)),m.tap&&m.tap(a)},C=function(a){n&&window.clearTimeout(f),m.drag&&m.drag(a)},D=function(a){n&&window.clearTimeout(f),m.release&&m.release(a)},E=function(a){m.touchStart&&m.touchStart(a)},F=function(a){m.touchMove&&m.touchMove(a)},G=function(a){m.touchEnd&&m.touchEnd(a)},H=function(a){m.mouseDown&&m.mouseDown(a)},I=function(a){m.mouseMove&&m.mouseMove(a)},J=function(a){m.mouseUp&&m.mouseUp(a)},K=function(){(m.introScreen&&l||!m.introScreen)&&m.imageLoader.isLoaded()&&(m.speaker.isReady()||0===m.speaker.getNumFiles())&&(m.start(),m.loadingScreen&&(m.loadingScreen.destroy(),m.loadingScreen=null),m.dispatchEvent("loaded"))},L=function(){var a,b,e,f,g,h,l,n;a=m.element.offsetWidth,e=a,b=m.element.offsetHeight,f=b,i&&i>f&&(f=i),!j&&90===Math.abs(window.orientation)||!k&&90!==Math.abs(window.orientation)?(h=m.height,g=m.width):(h=m.height/m.width*e,h>f&&(h=f),g=h/(m.height/m.width)),l=a>g?(a-g)/2:0,n=b>h?(b-h)/2:0,c.style.padding=n+"px "+l+"px",c.style.width=g-2*l+"px",c.style.height=h-2*n+"px",d.style.width=g+"px",d.style.height=h+"px",m.controller.scaleX=m.width/g,m.controller.scaleY=m.height/h,m.scale=g/m.width,m.dispatchEvent("resize")};return m.layers=[],m.width=a.width||1024,m.height=a.height||768,m.scale=1,m.debug=a.debug,m.state="intro",m.pause=function(){p||(p=!0,m.speaker&&(m.speaker.mute(),m.speaker.pause(),m.dispatchEvent("pause")))},m.resize=function(){L()},m.unpause=function(){p&&(p=!1,g=+new Date,m.speaker&&(m.speaker.unmute(),m.speaker.unpause(),m.dispatchEvent("unpause")))},m.getLayer=function(a){var b;for(b=0;b<m.layers.length;b+=1)if(m.layers[b].name===a)return m.layers[b]},m.createLayer=function(a,b){return b||(b={}),b.parentElement=d,b.width||(b.width=m.width),b.height||(b.height=m.height),BLOCKS.layer(a,b)},m.destroyLayer=function(a){a.destroy(),a=null},m.addLayer=function(a,b){var c;return m.getLayer(a)?(BLOCKS.warn("Cannot add layer '"+a+"' because it already exists."),void 0):(c=m.createLayer(a,b),m.layers.push(c),c)},m.removeLayer=function(a){var b=m.getLayer(a);b?m.destroyLayer(b):BLOCKS.warn("Cannot remove layer '"+a+"' because it cannot be found.")},m.addMotor=function(a){var b,c=arguments[1];return"drag"===a?c.controller=m.controller:c.clock=m,BLOCKS.motors&&BLOCKS.motors[a]?(b=BLOCKS.motors[a](c),b.type=a,c.object&&c.object.motorize(b),b.addEventListener("destroyed",m.removeMotor),q.push(b),b):(BLOCKS.warn("Cannot add motor of type '"+a+"' because its definition cannot be found."),void 0)},m.removeMotor=function(){var a;for(a=0;a<q.length;a+=1){q.splice(a,1);break}},m.addTicker=function(a,b,c){var d=(+new Date).toString()+r.length;return r.push({id:d,curTick:0,totalTicks:Math.ceil(60*b/1e3),callback:a,parameters:c}),d},m.removeTicker=function(a){var b;for(b=0;b<r.length;b+=1)if(r[b].id===a){r[b]=null,r.splice(b,1);break}},m.clearTickers=function(){r=[]},m.element=void 0!==b?b:document.getElementById("BlocksGame"),m.load=function(){var b;if(m.imageLoader.loadFromTree(a),a.sounds)for(b=0;b<a.sounds.length;b+=1)m.speaker.createSound(a.sounds[b]);m.imageLoader.addEventListener("update",function(a){var b=a.loaded+m.speaker.getNumFilesLoaded();m.loadingScreen&&m.loadingScreen.setProgress(b,a.total+m.speaker.getNumFiles())}),m.imageLoader.addEventListener("complete",function(){K()}),m.imageLoader.load()},m.stop=function(){o.removeEventListener("tick",x),o.removeEventListener("render",y),o.stop()},m.start=function(){g=+new Date,h=0,m.prepare&&m.prepare(),o.addEventListener("tick",x),o.addEventListener("render",y),o.start()},m.destroy=function(){var a;for(o.destroy(),a=0;a<m.layers;a+=1)m.removeLayer(m.layers[a])},m.isPaused=function(){return p},m.isDebug=function(){return n},m.imageLoader=BLOCKS.preloader(a.imagesPath),a&&a.loading&&(m.loadingScreen=BLOCKS.loadingScreen(a.loading,m)),a&&a.intro&&(m.introScreen=BLOCKS.introScreen(a.intro,m)),m.speaker=BLOCKS.speaker({path:a.audioPath,src:a.audioSpriteSrc}),m.speaker.addEventListener("ready",function(){K()},!0),function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}(),w(),m},BLOCKS.introScreen=function(a,b){"use strict";var c,d,e,f=BLOCKS.eventDispatcher(),g=function(){a.bg.image=b.imageLoader.loadNow(a.bg),a.bg.image.onload=h},h=function(){e=b.createLayer("intro",{zIndex:1}),c=BLOCKS.slice({layer:e,image:a.bg.image}),d=BLOCKS.clock(),d.addEventListener("tick",i),d.addEventListener("render",j),d.start()},i=function(){c.update()},j=function(){c.render()};return f.destroy=function(){d&&(d.destroy(),e.destroy(),e=null,c.destroy()),f=null},g(),f};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.layer=function(a,b){"use strict";var c,d,e={},f=b&&void 0!==b.zIndex?b.zIndex:0;return e.name=a,e.width=b&&b.width,e.height=b&&b.height,e.x=b&&b.x,e.y=b&&b.y,e.clear=function(){e.webGLEnabled?(e.ctx.colorMask(!0,!0,!0,!0),e.ctx.clearColor(0,0,0,0),e.ctx.clear(e.ctx.COLOR_BUFFER_BIT)):e.ctx.canvas.width=e.ctx.canvas.width,e.dirty=!1},e.destroy=function(){d&&d.removeChild(c),c=null,e.ctx=null,d=null,e=null},b||(b={}),function(){var g,h,i;if(c=document.createElement("canvas"),c.width=e.width||1e3,c.height=e.height||1e3,c.className="BlocksCanvas",c.style.zIndex=f,e.name&&(a=b.layer,c.id="BlocksCanvas_"+e.name),b.parentElement){for(d=b.parentElement,h=d.children,g=0;g<h.length;g+=1)if(h[g].style.zIndex>f){i=!0,d.insertBefore(c,h[g]);break}i||d.appendChild(c)}e.ctx?e.webGLEnabled=!0:(e.webGLEnabled=!1,e.ctx=c.getContext("2d"))}(),e},BLOCKS.loadingScreen=function(a,b){"use strict";var c,d,e,f,g,h,i=BLOCKS.eventDispatcher(),j=0,k="Arial,sans",l="24px",m="bold",n="#eee",o=0,p=0,q="loading... ",r=function(){f||(a.progressBar.layer=e.loading,f=BLOCKS.slice(a.progressBar),f.x=a.progressBar.x,f.y=a.progressBar.y,g=!0)},s=function(){a.bg.image=b.imageLoader.loadNow(a.bg),a.bg.image.onload=t,a.progressBar.image=b.imageLoader.loadNow(a.progressBar),a.progressBar.image.onload=function(){h=!0,e&&e.loading&&r()}},t=function(){e={loadingBg:b.createLayer("loadingBg",{enableWebGL:!1}),loading:b.createLayer("loading")},d=BLOCKS.slice({layer:e.loadingBg,image:a.bg.image}),h&&!f&&r(),c=BLOCKS.clock(),c.addEventListener("tick",u),c.addEventListener("render",v),c.start()},u=function(){d.update(),f&&f.update()},v=function(){g&&(g=!1,e.loading.clear(),f&&(f.cropWidth=f.width*j,f.dirty=!0),e.loading.webGLEnabled||(e.loading.ctx.fillStyle=n,e.loading.ctx.font=m+" "+l+" "+k,e.loading.ctx.textAlign="right",e.loading.ctx.fillText(q,o,p),e.loading.ctx.textAlign="left",e.loading.ctx.fillText(Math.round(100*j,10)+"%",o,p))),d.render(),f&&f.render()};return i.destroy=function(){c&&(c.destroy(),e.loadingBg.destroy(),e.loadingBg=null,e.loading.destroy(),e.loading=null,f&&f.destroy(),d.destroy()),i=null},i.setProgress=function(a,b){var c=a/b;j!==c&&(j=c,g=!0)},a&&a.message&&(a.message.fontFamily&&(k=a.message.fontFamily),a.message.fontSize&&(l=a.message.fontSize.toString().replace("px","")+"px"),a.message.fontWeight&&(m=a.message.fontWeight),a.message.fontColor&&(n=a.message.fontColor),a.message.x&&(o=a.message.x),a.message.y&&(p=a.message.y),a.message.text&&(q=a.message.text)),s(),i};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.motorTween=function(a,b){"use strict";var c,d=BLOCKS.motor(),e=!1,f=b.clock,g=b.object,h=b.callback,i=b.amount,j=0,k=60*(b.duration/1e3);return d.destroy=function(){e||(e=!0,f&&f.removeEventListener("tick",d.tick),d.dispatchEvent("destroyed",d),d=null)},d.tick=function(){e||(g.dirty=!0,g.layer.dirty=!0,Math.abs(i-j)<Math.abs(c)?(c>0?g[a]-=Math.abs(i-j):g[a]+=Math.abs(i-j),d.dispatchEvent("complete",d),h&&h(),d&&d.destroy()):(g[a]+=c,j+=c))},function(){return a?g?k?i?void 0===g[a]?(BLOCKS.error("Motor property does not exist on object: "+a),null):(f&&f.addEventListener("tick",d.tick),c=i/k,void 0):(BLOCKS.error("Amount is required for motor property: "+a),null):(BLOCKS.error("Duration is required for motor property: "+a),null):(BLOCKS.error("Object is required for motor property: "+a),null):(BLOCKS.error("Motor property parameter required"),null)}(),d},BLOCKS.motor=function(){"use strict";var a=BLOCKS.eventDispatcher(),b=!1;return a.destroy=function(){b=!0},a.tick=function(){},a},BLOCKS.motors={},BLOCKS.motors.moveTo=function(a){"use strict";var b=BLOCKS.motor(),c=!1,d=a.clock,e=a.object,f={x:a.x||0,y:a.y||0},g=a.callback,h=a.speed||1;return b.destroy=function(){c||(c=!0,d&&d.removeEventListener("tick",b.tick),b.dispatchEvent("destroyed",b),b=null)},b.tick=function(){var a,d;c||(a=BLOCKS.toolbox.dist(e,f),h>a?(e.x=f.x,e.y=f.y,b.dispatchEvent("complete",b),g&&g(),b&&b.destroy()):(d=BLOCKS.toolbox.angle(e,f),e.x+=h*Math.cos(d),e.y+=h*Math.sin(d),e.dirty=!0,e.layer.dirty=!0))},function(){d&&d.addEventListener("tick",b.tick)}(),b},BLOCKS.motors.move=function(a){"use strict";var b=BLOCKS.motor(),c=!1,d=a.clock,e=a.object,f={x:a.x||0,y:a.y||0},g=a.callback,h={x:0,y:0},i=BLOCKS.toolbox.angle(h,f),j=a.speed||1,k=j*Math.cos(i),l=j*Math.sin(i);return b.destroy=function(){c||(c=!0,d&&d.removeEventListener("tick",b.tick),b.dispatchEvent("destroyed",b),b=null)},b.tick=function(){var a;c||(a=BLOCKS.toolbox.dist(h,f),e.dirty=!0,e.layer.dirty=!0,j>=a?(e.x+=a*Math.cos(i),e.y+=a*Math.sin(i),b.dispatchEvent("complete",b),g&&g(),b&&b.destroy()):(h.x+=k,h.y+=l,e.x+=k,e.y+=l))},function(){d&&d.addEventListener("tick",b.tick)}(),b},BLOCKS.motors.rotate=function(a){"use strict";return a.angle&&(a.amount=a.angle),BLOCKS.motorTween("angle",a)},BLOCKS.motors.scale=function(a){"use strict";return BLOCKS.motorTween("scale",a)},BLOCKS.motors.alpha=function(a){"use strict";return BLOCKS.motorTween("alpha",a)},BLOCKS.motors.drag=function(a){"use strict";var b,c=BLOCKS.motor(),d=!1,e=a.controller,f=a.object,g=a.bounds,h=a.horizontalOnly,i=a.verticalOnly,j=function(b){return a.bounds&&(b.x<g.x&&(b.x=g.x),b.x>g.x+g.width&&(b.x=g.x+g.width),b.y<g.y&&(b.y=g.y),b.y>g.y+g.height&&(b.y=g.y+g.height)),b},k=function(a){a=j(a),i||(f.x=Math.round(a.x)),h||(f.y=Math.round(a.y)),f.dirty=!0},l=function(a){f.isPointInside(a)?(f.justTapped=!0,f.dirty=!0,b=!0,k(a)):(f.justNotTapped=!0,f.dirty=!0)},m=function(a){f.tapPos=a,e.drag&&b&&(k(a),f.dragging||f.dispatchEvent("onDragStart",f),f.dragging=!0)},n=function(){f.justTapped&&(f.justTapped=!1,f.dirty=!0),f.justNotTapped&&(f.justNotTapped=!1,f.dirty=!0),b&&(f.justReleased=!0,f.dispatchEvent("onDragEnd",f)),f.dragging=!1,b=!1};return c.destroy=function(){d||(d=!0,e.removeEventListener("tap",l),e.removeEventListener("drag",m),e.removeEventListener("release",n),e.removeEventListener("cancel",n),c.dispatchEvent("destroyed",c),c=null)},function(){return e?(e.addEventListener("tap",l),e.addEventListener("drag",m),e.addEventListener("release",n),e.addEventListener("cancel",n),void 0):(BLOCKS.error("A drag motor will not work without a controller"),c.destroy(),!1)}(),c},function(){var a;for(a in BLOCKS.motors)BLOCKS.motors.hasOwnProperty()&&(BLOCKS.motors[a].type=a)}();var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.preloader=function(a){"use strict";var b,c=BLOCKS.eventDispatcher(),d=[],e=function(){b+=1,c.dispatchEvent("update",{loaded:b,total:d.length}),b===d.length&&c.dispatchEvent("complete")},f=function(a,b){var c,d;for(c in a)if(a.hasOwnProperty(c)&&!(a[c]instanceof HTMLElement))if(b.apply(this,[c,a]),a[c]instanceof Object&&!(a[c]instanceof Array))f(a[c],b);else if(a[c]instanceof Array)for(d=0;d<a[c].length;d+=1)f(a[c][d],b)};return c.path=a||"",c.load=function(){var a;for(b=0,a=0;a<d.length;a+=1)d[a].loadStarted||(d[a].loadStarted=!0,d[a].image.src=c.path+d[a].src,d[a].image.addEventListener("load",e))},c.loadFromTree=function(a){f(a,function(a,b){"src"===a&&c.add(b)})},c.add=function(a){var b,c;if(a&&a.src&&(-1!==a.src.toLowerCase().indexOf("jpg")||-1!==a.src.toLowerCase().indexOf("png"))){for(b=0;b<d.length;b+=1)if(d[b].src===a.src)return a.image=d[b].image,d[b];return c={image:new Image,src:a.src,loadStarted:!1},a.image=c.image,d.push(c),c}},c.loadNow=function(a){var b;return b=new Image,b.src=c.path+a.src,b},c.getNumImages=function(){return d.length},c.getProgress=function(){return b/d.length},c.isLoaded=function(){return b>=d.length},c};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.slice=function(a){"use strict";var b,c,d=BLOCKS.eventDispatcher(),e=a&&a.numberOfFrames||1,f=0,g=!1,h=0,i=a&&a.resetOnComplete,j=0,k=a&&a.centerRegistrationPoint,l=!1,m=function(){b&&(d.width=b.image.width/e,d.height=b.image.height),k&&(d.offsetX=-d.width/2,d.offsetY=-d.height/2)};return d.name=a&&void 0!==a.name?a.name:void 0,d.width=a&&a.width||0,d.height=a&&a.height||0,d.x=0,d.y=0,d.offsetX=a&&a.offsetX||0,d.offsetY=a&&a.offsetY||0,d.frameOffsetX=a&&a.frameOffsetX||0,d.frameOffsetY=a&&a.frameOffsetY||0,d.loop=a&&a.loop,d.visible=!0,d.dirty=!0,d.hotspots=a&&a.hotspots,d.minHotspot=a&&a.minHotspot,d.layer=a&&a.layer,d.cropWidth=a&&a.cropWidth,d.cropHeight=a&&a.cropHeight,d.frameDelay=a&&void 0!==a.frameDelay?a.frameDelay:4,d.angle=a&&a.angle,d.alpha=a&&a.alpha,d.scale=a&&a.scale||1,d.update=function(){g||b&&e>1&&(h+=1,f>=e-1?h>=d.frameDelay&&(h=0,j+=1,d.loop===!0||"number"==typeof d.loop&&j<d.loop?(f=0,d.dirty=!0):(i&&(f=0,d.dirty=!0),g=!0,d.dispatchEvent("complete"))):h>=d.frameDelay&&(f+=1,h=0,d.dirty=!0))},d.pause=function(){g=!0},d.unpause=function(){g=!1},d.reset=function(){h=0,f=0,j=0},d.stop=function(){g=!0,d.reset()},d.play=function(){f>=e-1&&d.stop(),g=!1},d.render=function(){var a,g,h,i;if(d.dirty&&d.visible&&b&&(i=d.layer.ctx,d.layer&&d.layer.webGLEnabled||((d.angle||1!==d.alpha||d.colorize)&&(i.save(),h=!0),1!==d.alpha&&(i.globalAlpha=d.alpha),d.angle&&(i.translate(d.x,d.y),i.rotate(d.angle*Math.PI/180),i.translate(-d.x,-d.y)),d.colorize&&(c||(c=document.createElement("canvas").getContext("2d"),c.canvas.width=i.canvas.width,c.canvas.height=i.canvas.height),i=c,i.globalCompositeOperation="copy"),e>1?i.drawImage(b.image,f*d.width+d.frameOffsetX,d.frameOffsetY,d.cropWidth||d.width,d.cropHeight||d.height,d.x+d.offsetX,d.y+d.offsetY,d.cropWidth||d.width*d.scale,d.cropHeight||d.height*d.scale):i.drawImage(b.image,d.frameOffsetX,d.frameOffsetY,d.cropWidth||d.width,d.cropHeight||d.height,d.x+d.offsetX,d.y+d.offsetY,d.cropWidth||d.width*d.scale,d.cropHeight||d.height*d.scale),d.colorize&&(i.fillStyle=d.colorize,i.globalCompositeOperation="source-in",i.fillRect(d.x,d.y,d.width,d.height),i=d.layer.ctx,i.drawImage(c.canvas,0,0)),h&&i.restore()),l&&i)){for(g=d.getBounds(),g.length||(g=[g]),i.lineWidth=4,a=0;a<g.length;a+=1)d.dragging?(i.beginPath(),i.fillStyle="rgba(10, 255, 50, 0.4)",i.fillRect(g[a].x,g[a].y,g[a].width,g[a].height),i.closePath()):d.justTapped?(i.beginPath(),i.fillStyle="rgba(255, 10, 50, 0.4)",i.fillRect(g[a].x,g[a].y,g[a].width,g[a].height),i.closePath()):d.justNotTapped?(i.beginPath(),i.fillStyle="rgba(255, 10, 255, 0.4)",i.fillRect(g[a].x,g[a].y,g[a].width,g[a].height),i.closePath()):d.justReleased&&(i.beginPath(),i.fillStyle="rgba(125, 10, 255, 0.4)",i.fillRect(g[a].x,g[a].y,g[a].width,g[a].height),i.closePath(),d.justReleased=!1),i.beginPath(),i.strokeStyle="rgba(96, 255, 0, 0.5)",i.strokeRect(g[a].x,g[a].y,g[a].width,g[a].height),i.closePath();i.beginPath(),i.arc(d.x,d.y,7,0,2*Math.PI,!1),i.fillStyle="rgba(96, 255, 0, 0.5)",i.fill()}d.dirty=!1},d.isPointInside=function(a){var b,c=d.getBounds(),e=!1;if(!a)return BLOCKS.warn("slice.isPointInside point is falsy: "+a),void 0;for(c.length||(c=[c]),b=0;b<c.length;b+=1)if(a.x>=c[b].x&&a.x<=c[b].x+c[b].width&&a.y>=c[b].y&&a.y<=c[b].y+c[b].height){e=!0;break}return e},d.getBounds=function(a){var b,c,e,f;if(a||!d.hotspots&&!d.minHotspot)c={x:d.x+d.offsetX,y:d.y+d.offsetY,width:d.width,height:d.height};else{if(c=[],d.hotspots)for(b=0;b<d.hotspots.length;b+=1)c.push({x:d.x+d.offsetX+d.hotspots[b].x,y:d.y+d.offsetY+d.hotspots[b].y,width:d.hotspots[b].width,height:d.hotspots[b].height});d.minHotspot&&(e=d.width<d.minHotspot?d.minHotspot-d.width:0,f=d.height<d.minHotspot?d.minHotspot-d.height:0,c.push({x:d.x+d.offsetX-e/2,y:d.y+d.offsetY-f/2,width:d.width+e,height:d.height+f})),1===c.length&&(c=c[0])}return c},d.isRectInside=function(a){var b,c,e;if(!a)return BLOCKS.warn("slice.isRectangleInside rect is falsy: "+a),!1;for(e=d.getBounds(),e.length||(e=[e]),b=0;b<e.length;b+=1)if(a.x+a.width>e[b].x&&a.x<e[b].x+e[b].width&&a.y+a.height>e[b].y&&a.y<e[b].y+e[b].height){c=!0;break}return c},d.gotoLastFrame=function(){f!==e-1&&(f=e-1,d.dirty=!0)},d.show=function(){d.visible||(d.dirty=!0),d.visible=!0},d.hide=function(){d.visible&&(d.dirty=!0),d.visible=!1},d.destroy=function(){b=null,a=null,d=null},function(){var c=a.image,d=a.imageSrc||a.image&&a.src,e=c?!0:!1;c||d?(b={image:c,imageSrc:d,loaded:e},b.loaded?m():(b.image||(b.image=new Image),b.image.addEventListener("load",m),b.image.src=b.imageSrc)):m()}(),d};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.audio={},BLOCKS.audio.soundInstance=function(a){"use strict";var b={};return b.stop=a.stopSoundInstance(b),b.play=a.playSoundInstance(b),b.getSoundGain=a.getSoundInstanceGain(),b},BLOCKS.audio.audioElementPlayer=function(a){"use strict";var b,c,d,e,f,g=BLOCKS.eventDispatcher(),h=!1,i=!1,j={},k=!1,l=!1,m=function(){i||(i=!0,g.debug&&BLOCKS.debug("audio ready"),g.dispatchEvent("ready"))},n=function(){l||(l=!0,g.createSound({name:"BlocksTestSound",start:0,end:.5}),t("BlocksTestSound",m),window.setTimeout(function(){i||(t("BlocksTestSound",m),window.setTimeout(function(){i||m()},1e4))},1e4))},o=function(){n()},p=function(){g.debug&&BLOCKS.debug("load audio sprite: "+b),e&&window.clearInterval(e),e=window.setInterval(function(){var a,b;d.buffered.length&&(a=d.buffered.end(d.buffered.length-1),b=100*(a/d.duration),a&&!isNaN(b)&&b!==b&&(b=b,g.dispatchEvent("loadUpdate"),g.debug&&BLOCKS.debug("loadUpdate: "+Math.round(b)+"%")),window.Math.abs(a-d.duration)<.1&&(window.clearInterval(e),n(),g.dispatchEvent("loadComplete"),g.debug&&BLOCKS.debug("loadComplete")))},1e3),d.play(),d.pause()},q=function(){window.clearInterval(f),f=null,d.pause()},r=function(){q(),c=null},s=function(){c?d.currentTime>=c.end&&(c.loop===!0?d.currentTime=c.start:(q(),g.dispatchEvent("played"),c.callback&&c.callback(c.name),c=null)):window.clearInterval(f)},t=function(a,b){g.debug&&BLOCKS.debug("Play sound: "+a+" ("+j[a].start+" - "+j[a].end+")"),j[a].start>=0&&j[a].end>0?(c={name:j[a].name,start:j[a].start,end:j[a].end,loop:j[a].loop,sound:j[a].sound,callback:b},d.currentTime=j[a].start,d.play(),f||(f=window.setInterval(s,100))):BLOCKS.warn("Sound parameters not specified.")},u=function(){d.pause()},v=function(){c&&d.play()},w=function(){d.volume=0},x=function(){d.volume=1};return g.play=function(a,b){j[a]?t(a,b):BLOCKS.warn("Cannot play sound '"+a+"' because it was not defined")},g.pause=function(){u()},g.unpause=function(){v()},g.stop=function(){r()},g.mute=function(){k&&w(),k=!0},g.unmute=function(){k&&x(),k=!1},g.isMuted=function(){return k},g.isReady=function(){return i},g.load=function(){h||(h=!0,p())},g.createSound=function(a){j[a.name]={name:a.name,start:a.start,end:a.end,loop:a.loop}},g.getActiveSounds=function(){return[c]},g.getNumFiles=function(){return 1},g.getNumFilesLoaded=function(){return i?1:0},function(){a&&a.src?(b=a.path?a.path:"",b+=a.src,d=window.document.createElement("audio"),d.addEventListener("canplaythrough",o),d.canPlayType("audio/mpeg")?b+=".mp3":d.canPlayType("audio/ogg")&&(b+=".ogg"),d.src=b):BLOCKS.error("sprite filename not specified")}(),g},BLOCKS.audio.webAudioPlayer=function(a){"use strict";var b,c,d,e,f=BLOCKS.eventDispatcher(),g=!1,h=!1,i=!1,j=a&&a.path||"",k={},l={},m=[],n={},o=a.maxLoadTime||1e4,p=function(a){return n[a]||(n[a]={name:a,gain:d.createGain?d.createGain():d.createGainNode()},n[a].gain.connect(c)),n[a]},q=function(){var a,b;a=f.getNumFilesLoaded(),b=f.getNumFiles(),f.debug&&BLOCKS.debug("load: "+a+" of "+b),f.dispatchEvent("load",a,b),a===b&&(h||(h=!0,window.clearTimeout(e),f.debug&&BLOCKS.debug("audio ready"),f.dispatchEvent("ready")))
},r=function(a){a.request=new window.XMLHttpRequest,a.request.open("get",j+a.src+b,!0),a.request.responseType="arraybuffer",a.request.onload=function(){d.decodeAudioData(a.request.response,function(b){a.buffer=b,a.loaded=!0,q(a),a.request=null},function(){BLOCKS.debug&&BLOCKS.debug("Error decoding buffer: "+j+a.src+b),a.request=null})},a.request.send()},s=function(){var a;g=!0,a=d.createOscillator(),a.start?a.start(0,0,1):a.noteGrainOn&&a.noteGrainOn(0,0,1)},t=function(a){var b,c;for(b=0;b<m.length;b+=1)if(m[b]===a){m[b]=null,c=b;break}m.splice(c,1)},u=function(a){f.debug&&BLOCKS.debug("Sound '"+a.sound.name+"' Complete"),a.callback&&a.callback(a.name),t(a)},v=function(a){window.clearTimeout(a.timeout),a.source.stop?a.source.stop(0):a.source.noteGrainOff?a.source.noteGrainOff(0):a.source.noteOff(0),t(a)},w=function(a){window.clearTimeout(a.timeout),a.currentTime=(+new Date-a.startTime)/1e3,a.source.stop?a.source.stop(0):a.source.noteGrainOff?a.source.noteGrainOff(0):a.source.noteOff(0)},x=function(a){return a.gain.gain.value},y=function(a,b,e){a.gain===a.track.gain&&(a.source.disconnect(0),a.gain=d.createGain?d.createGain():d.createGainNode(),a.gain.connect(c),a.source.connect(a.gain)),f.debug&&BLOCKS.debug("speaker.setSoundGain of sound '"+a.name+"' to '"+b+"'"),e?(a.gain.gain.linearRampToValueAtTime(a.gain.gain.value,d.currentTime),a.gain.gain.linearRampToValueAtTime(b,d.currentTime+e)):a.gain.gain.value=b},z=function(a){var b;b=A(a.name,a.callback,a.track.name,a.currentTime),1!==a.gain.gain.value&&y(b,a.gain.gain.value),t(a)},A=function(a,c,e,g,h){var i={};return k[a].file.loaded?(m.push(i),i.sound=k[a],i.name=a,i.startTime=+new Date,i.currentTime=g?g:0,i.delay=h?d.currentTime+h:0,e?(n[e]||p(e),i.track=n[e]):i.track=n["default"],i.callback=c,i.source=d.createBufferSource(),i.source.buffer=k[a].file.buffer,i.source.loop=k[a].loop,i.gain=i.track.gain,i.source.connect(i.gain),i.timeout=window.setTimeout(u,1e3*(i.delay+i.source.buffer.duration-i.currentTime),i),f.debug&&(i.currentTime?BLOCKS.debug("Play sound: "+a+" ("+i.currentTime+" - "+k[a].end+"), src: "+k[a].file.src+b):BLOCKS.debug("Play sound: "+a+" ("+k[a].start+" - "+k[a].end+"), src: "+k[a].file.src+b)),i.source.start?i.currentTime?i.source.start(i.delay,i.currentTime,i.source.buffer.duration-i.currentTime):i.source.start(i.delay):i.source.noteGrainOn&&i.source.noteGrainOn(i.delay,i.currentTime,i.source.buffer.duration-i.currentTime),i):(f.debug&&BLOCKS.warn("Tried to play sound: "+a+", but it is not loaded yet"),void 0)};return f.play=function(a,b,c,d,e){return k[a]?A(a,b,c,d,e):(BLOCKS.warn("Cannot play sound '"+a+"' because it was not defined"),void 0)},f.getSoundDuration=function(a){return k[a].file.buffer.duration},f.getSoundInstanceGain=function(a){return x(a)},f.getSoundGain=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)if(c[b].name===a)return x(c[b])},f.setSoundInstanceGain=function(a,b,c){y(a,b,c)},f.setSoundGain=function(a,b,c){var d,e=m.slice(0);for(d=0;d<e.length;d+=1)e[d].name===a&&y(e[d],b,c)},f.stopSound=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&v(c[b])},f.pauseSound=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&w(c[b])},f.unpauseSound=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&z(c[b])},f.stopTrack=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].track.name===a&&v(c[b])},f.pauseTrack=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].track.name===a&&w(c[b])},f.unpauseTrack=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].track.name===a&&z(c[b])},f.stop=function(){var a,b=m.slice(0);for(a=0;a<b.length;a+=1)v(b[a])},f.pause=function(){var a,b=m.slice(0);for(a=0;a<b.length;a+=1)w(b[a])},f.unpause=function(){var a,b=m.slice(0);for(a=0;a<b.length;a+=1)z(b[a])},f.mute=function(){i||(i=!0,c.gain.value=0)},f.unmute=function(){i&&(i=!1,c.gain.value=1)},f.isMuted=function(){return i},f.load=function(){BLOCKS.debug("speaker.load"),g||(g=!0,e=window.setTimeout(function(){var a;BLOCKS.debug("loadTimeout");for(a in l)l.hasOwnProperty(a)&&(l[a].loaded||(l[a].request?(BLOCKS.warn("Sound file load has timed out. Aborting request and trying again: "+l[a].src),l[a].request.abort()):BLOCKS.warn("Sound file load has timed out. Sending additional request: "+l[a].src),r(l[a])))},o),s())},f.isReady=function(){return h},f.createSound=function(a){k[a.name]={name:a.name,start:a.start,end:a.end,loop:a.loop},l[a.src]||(l[a.src]={src:a.src},r(l[a.src])),k[a.name].file=l[a.src]},f.getActiveSoundInstances=function(){return m},f.getNumFiles=function(){var a,b;b=0;for(a in l)l.hasOwnProperty(a)&&(b+=1);return b},f.getNumFilesLoaded=function(){var a,b;b=0;for(a in l)l.hasOwnProperty(a)&&l[a].loaded&&(b+=1);return b},function(){var a,e=document.createElement("audio");a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,b=e.canPlayType("audio/mpeg;").replace(/no/,"")&&e.canPlayType&&!a?".mp3":".ogg","undefined"!=typeof AudioContext?d=new window.AudioContext:"undefined"!=typeof webkitAudioContext&&(d=new window.webkitAudioContext),d?(c=d.createGain?d.createGain():d.createGainNode(),c.connect(d.destination)):BLOCKS.error("Cannot create audio context."),p("default")}(),f},BLOCKS.speaker=function(a){"use strict";var b;return function(){a||(a={}),b="undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext?BLOCKS.audio.webAudioPlayer(a):BLOCKS.audio.audioElementPlayer(a)}(),b.debug=!1,b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.storage=function(){"use strict";var a=BLOCKS.eventDispatcher();return a.get=function(a){return window.localStorage?JSON.parse(window.localStorage.getItem(a)):null},a.save=function(a,b){window.localStorage.setItem(a,JSON.stringify(b))},a.destroy=function(){a=null},a};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.textField=function(a){"use strict";var b=BLOCKS.eventDispatcher(),c=!1,d=a.layer.ctx,e=[],f=function(a){var b;for(a.removeEventListener("destroyed",f),b=0;b<e.length;b+=1){e.splice(b,1);break}};return b.name=a&&void 0!==a.name?a.name:void 0,b.width=0,b.height=0,b.x=0,b.y=0,b.x=a.x||0,b.y=a.y||0,b.fontColor=a.fontColor||"#000000",b.fontFamily=a.fontFamily||"Arial,sans",b.fontSize=a.fontSize&&Number(a.fontSize.toString().replace("px",""))||24,b.fontWeight=a.fontWeight||"bold",b.textAlign=a.textAlign||"center",b.prependText=a.prependText||"",b.visible=!0,b.dirty=!0,b.layer=a&&a.layer,b.angle=a&&a.angle,b.alpha=a&&a.alpha,b.scale=a&&a.scale||1,b.text=a&&a.text||"",b.update=function(){},b.render=function(){var a,e,f,g,h,i,j,k;if(b.dirty&&b.visible){for((b.angle||1!==b.alpha)&&(d.save(),f=!0),1!==b.alpha&&(d.globalAlpha=b.alpha),b.angle&&(d.translate(b.x,b.y),d.rotate(b.angle*Math.PI/180),d.translate(-b.x,-b.y)),d.fillStyle=b.fontColor,d.font=b.fontWeight+" "+(Number(b.fontSize.toString().replace("px",""))*b.scale+"px")+" "+b.fontFamily,d.textAlign=b.textAlign,g=(b.prependText+b.text).split(" "),h="",j=b.x,k=b.y,a=0;a<g.length;a+=1)i=h+g[a]+" ",a&&b.width&&d.measureText(i).width>b.width?(d.fillText(h,j,k),h=g[a]+" ",k+=20):h=i;if(d.fillText(h,j,k),f&&d.restore(),c)for(e=b.getBounds(),e.length||(e=[e]),d.lineWidth=4,a=0;a<e.length;a+=1)b.dragging?(d.beginPath(),d.fillStyle="rgba(10, 255, 50, 0.4)",d.fillRect(e[a].x,e[a].y,e[a].width,e[a].height),d.closePath()):b.justTapped?(d.beginPath(),d.fillStyle="rgba(255, 10, 50, 0.4)",d.fillRect(e[a].x,e[a].y,e[a].width,e[a].height),d.closePath()):b.justNotTapped?(d.beginPath(),d.fillStyle="rgba(255, 10, 255, 0.4)",d.fillRect(e[a].x,e[a].y,e[a].width,e[a].height),d.closePath()):b.justReleased&&(d.beginPath(),d.fillStyle="rgba(125, 10, 255, 0.4)",d.fillRect(e[a].x,e[a].y,e[a].width,e[a].height),d.closePath(),b.justReleased=!1),d.beginPath(),d.strokeStyle="rgba(255, 80, 0, 0.5)",d.strokeRect(e[a].x,e[a].y,e[a].width,e[a].height),d.closePath()}b.dirty=!1},b.destroy=function(){d=null,a=null,b=null},b.motorize=function(a){a.addEventListener("destroyed",f),e.push(a)},b.stopMotors=function(a){var b,c=e.slice(0);for(b=0;b<c.length;b+=1)a?c[b].type===a&&c[b].destroy():c[b].destroy()},b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.toolbox={},BLOCKS.toolbox.angle=function(a,b){"use strict";var c,d=b.x-a.x,e=b.y-a.y;return 0===d?c=e>0?Math.PI/2:-Math.PI/2:(c=Math.atan(e/d),e>0?0>d&&(c=Math.PI+c):c=0>d?Math.PI+c:2*Math.PI+c),c},BLOCKS.toolbox.randomizeArr=function(a){var b,c,d;for(b=a.length;b;c=parseInt(Math.random()*b,10),d=a[--b],a[b]=a[c],a[c]=d);return a},BLOCKS.toolbox.isPointInsideRect=function(a,b){return a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height},BLOCKS.toolbox.isRectInsideRect=function(a,b){return a.x+a.width>b.x&&a.x<b.x+b.width&&a.y+a.height>b.y&&a.y<b.y+b.height},BLOCKS.toolbox.dist=function(a,b){"use strict";var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},BLOCKS.toolbox.vector=function(a){var b={x:a,y:a};return b.scale=function(a){return b.x*=a,b.y*=a,b},b.normalize=function(){return b.scale(1/b.magnitude())},b.magnitude=function(){return Math.sqrt(b.x*b.x+b.y*b.y)},b},BLOCKS.toolbox.sum=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},BLOCKS.toolbox.diff=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},BLOCKS.toolbox.dot=function(a,b){return a.x*b.x+a.y*b.y},BLOCKS.key=function(a){"use strict";var b=BLOCKS.eventDispatcher(),c=a.layer,d=function(){};return b.x=a.x||0,b.y=a.y||0,b.width=a.width||80,b.height=a.height||80,b.scale=a.scale||1,b.visible=!1,b.dirty=!0,b.name=a.name,b.alpha=1,b.color=a.color||"#333",b.textColor=a.textColor||"#eee",b.keyCode=a.keyCode,b.update=function(){},b.render=function(){b.dirty&&b.visible&&(c.ctx.save(),c.ctx.globalAlpha=b.alpha,c.ctx.fillStyle=b.color,c.ctx.fillRect(b.x,b.y,b.width,b.height),c.ctx.fillStyle=b.textColor,c.ctx.font="bold 24px sans-serif",c.ctx.textAlign="center",c.ctx.fillText(b.name,b.x+b.width/2,b.y+b.height/2+7),c.ctx.restore())},b.destroy=function(){},d(),b},BLOCKS.virtualKeyboard=function(a,b){"use strict";var c=BLOCKS.eventDispatcher(),d=b.layer,e=[[{name:"1",keyCode:49},{name:"2",keyCode:50},{name:"3",keyCode:51},{name:"4",keyCode:52},{name:"5",keyCode:53},{name:"6",keyCode:54},{name:"7",keyCode:55},{name:"8",keyCode:56},{name:"9",keyCode:57},{name:"0",keyCode:48}]],f=[],g=function(){var a,g,h,i=20,j=20;for(b.customKeys&&e.push(b.customKeys),a=0;a<e.length;a+=1)for(g=0;g<e[a].length;g+=1)e[a][g].layer=d,h=BLOCKS.key(e[a][g]),h.width=h.width*h.scale,h.scale<1&&(h.width+=(h.scale-1)*j*g),h.x=c.x+i+h.width*g,g<=e[a].length-1&&(h.x+=j*g),h.y=c.y+i+h.height*a,a<=e.length-1&&(h.y+=j*a),f.push(h)};return c.x=b.x||0,c.y=b.y||0,c.width=b.width||640,c.height=b.height||480,c.dirty=!1,c.alpha=.8,c.visible=!1,c.update=function(){var a;for(a=0;a<f.length;a+=1)f[a].update()},c.render=function(){var a;if(c.dirty){for(d.clear(),a=0;a<f.length;a+=1)f[a].visible=c.visible,f[a].dirty=!0;c.visible&&(d.ctx.save(),d.ctx.globalAlpha=c.alpha,d.ctx.fillStyle="white",d.ctx.fillRect(c.x,c.y,c.width,c.height),d.ctx.restore()),c.dirty=!1}for(a=0;a<f.length;a+=1)f[a].render()},c.destroy=function(){var a;for(a=0;a<f.length;a+=1)f[a].destroy()},c.onTap=function(b){var d;if(c.visible)for(d=0;d<f.length;d+=1)if(BLOCKS.toolbox.isPointInsideRect(b,f[d])){a.simulateKeyDownEvent(f[d].keyCode);break}c.visible=!1,c.dirty=!0},g(),c};